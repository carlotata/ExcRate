<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>API Data Fetch - Dynamic Currencies</title>
      <link rel="stylesheet" href="index.css" />
   </head>
   <body>
      <div class="container">
         <h4>Exchange Rate - API</h4>

         <label for="currency1">From Currency:</label>
         <select id="currency1">
            <option value="" disabled selected></option>
         </select>

         <label for="currency2">To Currency:</label>
         <select id="currency2">
            <option value="" disabled selected></option>
         </select>

         <div id="dataDisplay"></div>

         <button id="closeFetch" onclick="closeFetch()">Close</button>
         <button id="fetchData" onclick="fetchData()">Exchange Currency</button>
      </div>
   </body>
   <script src="index.js"></script>
   <script>
      // Ensure that the browser supports the service worker API
      if (navigator.serviceWorker) {
         // Start registration process on every page load
         window.addEventListener("load", () => {
            navigator.serviceWorker
               // The register function takes as argument
               // the file path to the worker's file
               .register("/service_worker.js")
               // Gives us registration object
               .then((reg) => console.log("Service Worker Registered"))
               .catch((swErr) =>
                  console.log(`Service Worker Installation Error: ${swErr}}`)
               );
         });
      }

      var cacheName = "geeks-cache-v1";
      var cacheAssets = [
         "/assets/pages/offline-page.html",
         "/assets/styles/offline-page.css",
         "/assets/script/offline-page.js",
      ];

      // Call install Event
      self.addEventListener("install", (e) => {
         // Wait until promise is finished
         e.waitUntil(
            caches.open(cacheName).then((cache) => {
               console.log(`Service Worker: Caching Files: ${cache}`);
               cache
                  .addAll(cacheAssets)
                  // When everything is set
                  .then(() => self.skipWaiting());
            })
         );
      });

      // Call Activate Event
      self.addEventListener("activate", (e) => {
         console.log("Service Worker: Activated");
         // Clean up old caches by looping through all of the
         // caches and deleting any old caches or caches that
         // are not defined in the list
         e.waitUntil(
            caches.keys().then((cacheNames) => {
               return Promise.all(
                  cacheNames.map((cache) => {
                     if (cache !== cacheName) {
                        console.log("Service Worker: Clearing Old Cache");
                        return caches.delete(cache);
                     }
                  })
               );
            })
         );
      });
   </script>
</html>
